// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  email       String   @unique
  password    String
  firstName   String?
  lastName    String?
  balance     Float    @default(0)
  isAdmin     Boolean  @default(false)
  isActive    Boolean  @default(true)
  kycStatus   String   @default("pending") // pending, approved, rejected
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  deposits    Deposit[]
  withdrawals Withdrawal[]
  trades      Trade[]
  sessions    Session[]

  @@map("users")
}

model Session {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Deposit {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  amount      Float
  currency    String   // USDT, BTC, ETH, BNB
  address     String
  status      String   @default("pending") // pending, approved, rejected
  txHash      String?
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("deposits")
}

model Withdrawal {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  amount      Float
  currency    String
  address     String
  status      String   @default("pending") // pending, approved, rejected
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("withdrawals")
}

model Trade {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  pair        String   // EUR/USD, GBP/USD, etc.
  amount      Float
  direction   String   // CALL, PUT
  entryPrice  Float
  exitPrice   Float?
  payout      Float?   // Total payout amount for winning trades
  profit      Float?   // Net profit/loss (payout - amount)
  status      String   @default("ACTIVE") // ACTIVE, WON, LOST, EXPIRED
  duration    Int      @default(60) // seconds
  createdAt   DateTime @default(now())
  closedAt    DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("trades")
}

model MarketData {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  pair          String   @unique
  price         Float
  change        Float
  changePercent Float
  high24h       Float?
  low24h        Float?
  volume24h     Float?
  marketCap     Float?
  source        String   @default("api") // api, manual, calculated
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())

  @@map("market_data")
}

model CandlestickData {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  pair      String
  timeframe String   // 1m, 5m, 15m, 1h, 4h, 1d
  timestamp BigInt   // Unix timestamp in milliseconds
  open      Float
  high      Float
  low       Float
  close     Float
  volume    Float?
  source    String   @default("api") // api, binance, coingecko, alphavantage
  createdAt DateTime @default(now())

  @@unique([pair, timeframe, timestamp])
  @@map("candlestick_data")
}

model PriceHistory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  pair      String
  price     Float
  timestamp DateTime @default(now())
  source    String   @default("api")

  @@map("price_history")
}
